<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sham Salong</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right,#4B0082,#FFD700);
      margin:0; padding:0; color:#fff;
    }
    header {
      background: rgba(0,0,0,0.8);
      padding:15px; display:flex;
      justify-content:space-between; align-items:center; flex-wrap:wrap;
    }
    header h1 { margin:0; font-size:24px; }
    header .auth-buttons { display:flex; flex-direction: column; gap:10px; align-items:flex-end; }
    header button { padding:8px 12px; border:none; cursor:pointer; border-radius:5px; background:#FFD700; color:#000; font-weight:bold; }
    section { padding:40px 20px; text-align:center; }
    h1,h2 { margin-bottom:20px; }
    .about,.booking,.dashboard,.guest-booking { border-radius:10px; padding:30px; margin:20px auto; max-width:800px; background: rgba(0,0,0,0.7); }
    input, select, button { display:block; margin:10px auto; padding:10px; width:80%; border-radius:5px; border:1px solid #ccc; }
    button.submit-btn { background:#FFD700; color:#000; font-weight:bold; cursor:pointer; }
    .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .modal-content { background:#fff; color:#000; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center; position:relative; }
    .close-btn { position:absolute; right:10px; top:10px; background:red; color:#fff; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer; }
    .toast { visibility:hidden; min-width:200px; text-align:center; border-radius:4px; padding:12px; position:fixed; z-index:3000; left:50%; bottom:30px; font-size:16px; transform:translateX(-50%); color:#fff; }
    .toast.show { visibility:visible; animation:fadein 0.5s, fadeout 0.5s 2.5s; }
    @keyframes fadein { from {opacity:0;} to {opacity:1;} }
    @keyframes fadeout { from {opacity:1;} to {opacity:0;} }
    .dashboard ul { list-style:none; padding:0; }
    .dashboard li { color:#000; margin:10px; padding:10px; border-radius:5px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; background:#fff9b0; }
    .dashboard li button { margin-left:5px; cursor:pointer; }
  </style>
</head>
<body>
<header>
  <h1>Sham Salong</h1>
  <div class="auth-buttons">
    <span id="userName"></span>
    <button id="loginBtn" onclick="openModal('login')">Logga in</button>
    <button id="registerBtn" onclick="openModal('register')">Registrera</button>
    <button id="logoutBtn" onclick="logout()" style="display:none;">Logga ut</button>
  </div>
</header>

<section class="about">
  <h1>Om oss</h1>
  <p>Sham Salong erbjuder kvalitativa klippningar och sk√§ggv√•rd i hj√§rtat av staden.</p>
</section>

<section class="booking">
  <h2>F√∂r g√§ster / eng√•ngsbes√∂kare</h2>
  <form id="guestBookingForm">
    <input type="text" id="guestName" placeholder="Ditt namn" required>
    <input type="text" id="guestPhone" placeholder="Telefonnummer" required>
    <select id="guestService" required>
      <option value="">V√§lj tj√§nst</option>
      <option value="fade">Fade - 250 kr</option>
      <option value="sk√§gg">Sk√§gg - 150 kr</option>
      <option value="f√§rgning">F√§rgning - 600 kr</option>
      <option value="barn">Barnklippning - 200 kr</option>
    </select>
    <input type="datetime-local" id="guestTime" required>
    <button type="submit" class="submit-btn">Boka som g√§st</button>
  </form>
</section>

<section class="booking">
  <h2>Inline Calendly Booking</h2>
  <div class="calendly-inline-widget" data-url="https://calendly.com/mohammadyamenmustafa37?background_color=4b0082&text_color=ffffff&primary_color=ffd700" style="min-width:320px;height:700px;"></div>
</section>

<section class="dashboard" id="dashboard" style="display:none;">
  <h2>Min sida</h2>
  <p id="welcomeMsg"></p>
  <ul id="userBookings"></ul>
</section>

<section class="contact">
  <h2>Kontakta oss</h2>
  <p>üìû 0793488688</p>
  <p>üìß shams.barbershop74@gmail.com</p>
  <p>üìç Esplanaden 1B</p>
</section>

<div id="authModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal()">√ó</button>
    <h3 id="modalTitle">Logga in</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="L√∂senord">
    <button id="authSubmit">Skicka</button>
  </div>
</div>

<div id="toast"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, setDoc, serverTimestamp, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCc2a7sx7nq-mH2R6IkWend_HUb06wgZ2A",
    authDomain: "shamsalong-6c54c.firebaseapp.com",
    projectId: "shamsalong-6c54c",
    storageBucket: "shamsalong-6c54c.appspot.com",
    messagingSenderId: "1023072544720",
    appId: "1:1023072544720:web:968e31cc9350bc95803bd5"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentMode="login", unsubscribeBookings=null;

  function showToast(msg,color="black"){
    const t=document.getElementById("toast");
    t.innerText=msg; t.style.background=color;
    t.className="toast show";
    setTimeout(()=>t.className=t.className.replace("show",""),3000);
  }

  window.openModal=(mode)=>{currentMode=mode; document.getElementById("modalTitle").innerText=mode==="login"?"Logga in":"Registrera"; document.getElementById("authModal").style.display="flex";}
  window.closeModal=()=>document.getElementById("authModal").style.display="none";

  async function createUserDoc(user){
    await setDoc(doc(db,"users",user.uid),{email:user.email,lastLogin:serverTimestamp()},{merge:true});
  }

  document.getElementById("authSubmit").addEventListener("click",async()=>{
    const email=document.getElementById("email").value;
    const pass=document.getElementById("password").value;
    try{
      let userCredential;
      if(currentMode==="login") userCredential = await signInWithEmailAndPassword(auth,email,pass);
      else userCredential = await createUserWithEmailAndPassword(auth,email,pass);
      await createUserDoc(userCredential.user);
      showToast(currentMode==="login"?"Inloggad!":"Registrerad!","green");
      closeModal();
      loadDashboard(userCredential.user);
    }catch(err){showToast(err.message,"red");}
  });

  function logout(){
    if(unsubscribeBookings) unsubscribeBookings();
    unsubscribeBookings=null;
    signOut(auth).then(()=>{
      document.getElementById("dashboard").style.display="none";
      document.getElementById("loginBtn").style.display="inline-block";
      document.getElementById("registerBtn").style.display="inline-block";
      document.getElementById("logoutBtn").style.display="none";
      document.getElementById("userName").textContent="";
      showToast("Utloggad!","green");
    });
  }

  function loadDashboard(user){
    document.getElementById("dashboard").style.display="block";
    document.getElementById("loginBtn").style.display="none";
    document.getElementById("registerBtn").style.display="none";
    document.getElementById("logoutBtn").style.display="inline-block";
    document.getElementById("userName").textContent = `V√§lkommen, ${user.email}`;
    const bookingsRef = collection(db,"users",user.uid,"bookings");
    unsubscribeBookings = onSnapshot(bookingsRef, snapshot=>{
      const userBookings = document.getElementById("userBookings");
      userBookings.innerHTML="";
      snapshot.forEach(docSnap=>{
        const booking = docSnap.data();
        const li = document.createElement("li");
        li.textContent = `${booking.service} - ${booking.time}`;
        userBookings.appendChild(li);
      });
    });
  }

  // Guest booking form
  document.getElementById("guestBookingForm").addEventListener("submit",async e=>{
    e.preventDefault();
    const name = e.target.guestName.value;
    const phone = e.target.guestPhone.value;
    const service = e.target.guestService.value;
    const time = e.target.guestTime.value;
    try{
      await addDoc(collection(db,"guestBookings"),{name,phone,service,time,createdAt:serverTimestamp()});
      showToast("Bokning skapad!","green");
      e.target.reset();
    }catch(err){showToast(err.message,"red");}
  });
</script>

<script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
</body>
</html>