<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sham Salong</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(to right,#4B0082,#FFD700); margin:0; padding:0; color:#fff; }
    header { background: rgba(0,0,0,0.8); padding:15px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    header h1 { margin:0; font-size:24px; }
    header .auth-buttons { display:flex; gap:10px; align-items:center; }
    header button { padding:8px 12px; border:none; cursor:pointer; border-radius:5px; background:#FFD700; color:#000; font-weight:bold; }
    section { padding:40px 20px; text-align:center; }
    h1,h2 { margin-bottom:20px; }
    .about,.booking,.dashboard,.calendly-wrapper { border-radius:10px; padding:30px; margin:20px auto; max-width:800px; }
    .about { background: rgba(75,0,130,0.9); }
    .booking { background: rgba(0,0,0,0.7); }
    .dashboard { background: rgba(0,0,0,0.6); }
    .calendly-wrapper { background: rgba(0,0,0,0.7); color:#fff; display:none; }
    input,select { display:block; margin:10px auto; padding:10px; width:80%; border-radius:5px; border:1px solid #ccc; background:#fffbea; color:#000; }
    button.submit-btn { background:#FFD700; color:#000; font-weight:bold; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; margin-top:10px; }
    .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .modal-content { background:#fff; color:#000; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center; position:relative; }
    .modal-content input,.modal-content select { width:90%; margin:10px 0; }
    .close-btn { position:absolute; right:10px; top:10px; background:red; color:#fff; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer; }
    .toast { visibility:hidden; min-width:200px; text-align:center; border-radius:4px; padding:12px; position:fixed; z-index:3000; left:50%; bottom:30px; font-size:16px; transform:translateX(-50%); color:#fff; }
    .toast.show { visibility:visible; animation:fadein 0.5s, fadeout 0.5s 2.5s; }
    @keyframes fadein { from {opacity:0;} to {opacity:1;} }
    @keyframes fadeout { from {opacity:1;} to {opacity:0;} }
    .contact { background: rgba(0,0,0,0.8); padding:20px; text-align:center; }
  </style>
</head>
<body>
  <header>
    <h1>Sham Salong</h1>
    <div class="auth-buttons">
      <span id="userName" style="margin-right:10px;"></span>
      <button id="loginBtn" onclick="openModal('login')">Logga in</button>
      <button id="registerBtn" onclick="openModal('register')">Registrera</button>
      <button id="logoutBtn" onclick="logout()" style="display:none;">Logga ut</button>
    </div>
  </header>

  <section class="about">
    <h1>Om oss</h1>
    <p>V√§lkommen till Sham Salong ‚Äì din lokala barbershop i hj√§rtat av staden.</p>
  </section>

  <section class="calendly-wrapper" id="calendlyWrapper">
    <h2>Boka en tid</h2>
    <label for="serviceSelect">V√§lj tj√§nst:</label>
    <select id="serviceSelect">
      <option value="Fade">Fade - 250 kr</option>
      <option value="Sk√§gg">Sk√§gg - 150 kr</option>
      <option value="F√§rgning">F√§rgning - 600 kr</option>
      <option value="Barn">Barnklippning - 200 kr</option>
    </select>
    <div id="calendlyInline" style="min-width:320px;height:700px;"></div>
  </section>

  <section class="contact">
    <h2>Kontakta oss</h2>
    <p>üìû 0793488688</p>
    <p>üìß shams.barbershop74@gmail.com</p>
    <p>üìç Esplanaden 1B</p>
  </section>

  <div id="authModal" class="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">√ó</button>
      <h3 id="modalTitle">Logga in</h3>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="L√∂senord">
      <button id="authSubmit">Skicka</button>
      <hr>
      <button id="googleBtn">Logga in med Google</button>
    </div>
  </div>

  <div id="toast"></div>

  <script type="module" src="https://assets.calendly.com/assets/external/widget.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { setDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCc2a7sx7nq-mH2R6IkWend_HUb06wgZ2A",
      authDomain: "shamsalong-6c54c.firebaseapp.com",
      projectId: "shamsalong-6c54c",
      storageBucket: "shamsalong-6c54c.appspot.com",
      messagingSenderId: "1023072544720",
      appId: "1:1023072544720:web:968e31cc9350bc95803bd5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = app; // Firestore usage only for auth user docs

    let currentMode="login";

    function showToast(msg,color="black"){
      const t=document.getElementById("toast");
      t.innerText=msg;
      t.style.background=color;
      t.className="toast show";
      setTimeout(()=>t.className=t.className.replace("show",""),3000);
    }

    window.openModal=(mode)=>{
      currentMode=mode;
      document.getElementById("modalTitle").innerText=mode==="login"?"Logga in":"Registrera";
      document.getElementById("authModal").style.display="flex";
    }

    window.closeModal=()=>document.getElementById("authModal").style.display="none";

    async function createUserDoc(user){
      await setDoc(doc(db,"users",user.uid),{name:user.displayName||"",email:user.email,lastLogin:serverTimestamp()},{merge:true});
    }

    document.getElementById("authSubmit").addEventListener("click",async()=>{
      const email=document.getElementById("email").value;
      const pass=document.getElementById("password").value;
      try{
        let userCredential;
        if(currentMode==="login") userCredential = await signInWithEmailAndPassword(auth,email,pass);
        else userCredential = await createUserWithEmailAndPassword(auth,email,pass);
        await createUserDoc(userCredential.user);
        showToast(currentMode==="login"?"Inloggad!":"Registrerad!","green");
        closeModal();
      }catch(err){showToast(err.message,"red");}
    });

    document.getElementById("googleBtn").addEventListener("click",async()=>{
      try{
        const result = await signInWithPopup(auth,new GoogleAuthProvider());
        await createUserDoc(result.user);
        showToast("Inloggad med Google!","green");
        closeModal();
      }catch(err){showToast(err.message,"red");}
    });

    function logout(){
      signOut(auth).then(()=>showToast("Utloggad!","green"));
      document.getElementById("calendlyWrapper").style.display="none";
    }

    function initCalendly(serviceValue){
      const parent=document.getElementById("calendlyInline");
      parent.innerHTML="";
      Calendly.initInlineWidget({
        url:'https://calendly.com/mohammadyamenmustafa37',
        parentElement: parent,
        prefill: { customAnswers:{ a1: serviceValue } },
        utm:{}
      });
    }

    onAuthStateChanged(auth, async user=>{
      const loginBtn=document.getElementById("loginBtn");
      const registerBtn=document.getElementById("registerBtn");
      const logoutBtn=document.getElementById("logoutBtn");
      const userName=document.getElementById("userName");
      const calendlyWrapper=document.getElementById("calendlyWrapper");

      if(user && user.emailVerified!==false){
        loginBtn.style.display="none";
        registerBtn.style.display="none";
        logoutBtn.style.display="inline-block";
        const userSnap=await getDoc(doc(db,"users",user.uid));
        userName.textContent=userSnap.exists()?`V√§lkommen, ${userSnap.data().name}`:"";
        calendlyWrapper.style.display="block";
        const service = document.getElementById("serviceSelect").value;
        initCalendly(service);
        document.getElementById("serviceSelect").addEventListener("change",()=>{
          initCalendly(document.getElementById("serviceSelect").value);
        });
      }else{
        loginBtn.style.display="inline-block";
        registerBtn.style.display="inline-block";
        logoutBtn.style.display="none";
        userName.textContent="";
        calendlyWrapper.style.display="none";
      }
    });
  </script>
</body>
</html>